import{o as q,C as p,at as R,a as x,X as y,p as S,q as c,t as D,M as O,v as l,w as r,a2 as I,L as b,x as s,K as _,a0 as Y,g as A}from"./vendor-7d8626b5.js";import{g as E}from"./base-a6590bda.js";import{s as F,d as j,g as H}from"./order-c813a367.js";import{u as P}from"./useHandleData-6ee70150.js";import{u as n,r as K}from"./index-16b2bfc2.js";const X={class:"table-box"},$={key:0},z={class:"flx-justify-between pt8"},G=_("div",null,null,-1),J=q({name:"base_order_add"}),oe=q({...J,setup(Q){const u=p(),f=R(),d=x(()=>f.query&&f.query.id||""),T=x(()=>f.query&&f.query.bc||""),v=p(""),N=p([]),k=p([]);y(()=>N.value,t=>{k.value=[...t]}),y(()=>k.value,t=>{u.value.tableData=[...t]}),y(()=>v.value,t=>{k.value=N.value.filter(e=>e.materialName.toLowerCase().indexOf(t.toLowerCase())>-1)});const w=p([{prop:"materialName",label:n("base.productName")},{prop:"stockNumber",label:n("base.stockNumber"),showOverflowTooltip:!1},{prop:"reportNumber",label:n("base.reportNumber"),showOverflowTooltip:!1}]),L=t=>(t.data.forEach(e=>{e.materialId=e.id,delete e.id,e.materialName=e.name,delete e.name,e.materialCode=e.code,delete e.code,e.reportNumber=0,e.stockNumber=0}),N.value=t.data,t),U=async()=>{const t=N.value.filter(a=>a.reportNumber!=0||a.stockNumber!=0).map(a=>({materialId:a.materialId,materialName:a.materialName,materialCode:a.materialCode,stockNumber:a.stockNumber,reportNumber:a.reportNumber,remark:a.remark})),e={billDate:A(new Date).format("YYYY-MM-DD"),itemList:t};await P(F,e,n("common.save")),d.value&&await j({id:d.value}),V()},V=()=>{K.back()},B=()=>{const t=setInterval(()=>{!u.value.tableData.length||H({pid:d.value}).then(e=>{(e.data||[]).forEach(i=>{const m=u.value.tableData.findIndex(h=>h.materialCode==i.materialCode);m>-1&&(u.value.tableData[m].reportNumber=i.reportNumber,u.value.tableData[m].stockNumber=i.stockNumber)}),clearInterval(t)})},500)};return S(()=>{d.value&&B()}),(t,e)=>{const a=c("el-button"),i=c("el-input"),m=c("el-space"),h=c("el-tooltip"),g=c("el-input-number"),M=c("ProTable");return D(),O("div",X,[l(M,{ref_key:"proTable",ref:u,dataCallback:L,pagination:!1,title:s(n)("base.product"),columns:w.value,requestApi:s(E)},{tableHeader:r(()=>[l(m,null,{default:r(()=>[l(a,{type:"primary",onClick:V},{default:r(()=>[I(b(s(n)("common.back")),1)]),_:1}),l(i,{modelValue:v.value,"onUpdate:modelValue":e[0]||(e[0]=o=>v.value=o),placeholder:s(n)("base.productName")},null,8,["modelValue","placeholder"]),s(d)?(D(),O("p",$,[_("span",null,b(s(n)("common.billCode"))+"\uFF1A",1),_("span",null,b(s(T)),1)])):Y("",!0)]),_:1})]),materialName:r(o=>[l(h,{effect:"dark",trigger:"click",placement:"top-start",content:o.row.materialCode},{default:r(()=>[_("span",null,b(o.row.materialName),1)]),_:2},1032,["content"])]),stockNumber:r(o=>[l(g,{modelValue:o.row.stockNumber,"onUpdate:modelValue":C=>o.row.stockNumber=C,min:0,style:{width:"100px"}},null,8,["modelValue","onUpdate:modelValue"])]),reportNumber:r(o=>[l(g,{modelValue:o.row.reportNumber,"onUpdate:modelValue":C=>o.row.reportNumber=C,min:0,style:{width:"100px"}},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["title","columns","requestApi"]),_("div",z,[G,l(m,null,{default:r(()=>[l(a,{type:"primary",onClick:U},{default:r(()=>[I(b(t.$t("common.save")),1)]),_:1})]),_:1})])])}}});export{oe as default};
