import{a as W,b as S,d as z,u as O,c as U}from"./base-a6590bda.js";import{u as C}from"./useHandleData-6ee70150.js";import{u as t,a as V}from"./index-16b2bfc2.js";import{o as x,C as u,q as n,t as j,M as H,v as r,w as s,a2 as _,L as b,x as c,K as I,E as M,av as K,aw as R}from"./vendor-7d8626b5.js";import{g as G}from"./type-78965f9f.js";const J={class:"table-box"},Q=["onClick"],X=x({name:"base_sku"}),re=x({...X,setup(Y){const D=a=>new Promise((e,o)=>{const i=new FileReader;i.onload=l=>{const m=new Uint8Array(l.target.result),y=K(m,{type:"array"}),g=y.Sheets[y.SheetNames[0]],w=R.sheet_to_json(g,{header:1});e(w)},i.onerror=l=>{o(l)},i.readAsArrayBuffer(a)}),L=a=>new Promise(e=>{setTimeout(()=>{e(!0)},a)}),A=async a=>{try{const e=await D(a);let o=[];e.forEach(l=>{l.length===2&&o.push({name:l[0].trim(),code:l[1].trim()})}),o.forEach((l,m)=>{l.priority=o.length-m});let i=1;for(let l of o)M({type:"success",message:`${i}/${o.length}`,duration:200}),await L(200),await S(l),i+=1}catch{}return!1},k=t("base.product"),p=u(),T=u(),f=u([]),B=u([{type:"selection",fixed:"left",width:60},{prop:"name",label:t("base.productName"),minWidth:120,search:{el:"input"}},{prop:"code",label:t("base.productCode"),minWidth:120,search:{el:"input"}},{prop:"typeName",label:t("base.typeName"),minWidth:120,search:{el:"input"}},{prop:"typeNameFr",label:t("base.typeNameFr"),minWidth:120,search:{el:"input"}},{prop:"priority",label:t("common.priority"),sortable:!0},{prop:"createdAt",minWidth:150,label:t("common.createdAt")},{prop:"operation",label:t("common.operate"),width:180}]),h=u([{field:"name",type:"text",label:t("base.productName"),rules:[{required:!0,message:t("base.productName"),trigger:"blur"}]},{field:"code",type:"text",label:t("base.productCode")},{field:"typeId",type:"select",optionsData:f.value,label:t("base.typeName"),rules:[{required:!0,message:t("base.productName"),trigger:"blur"}]},{field:"priority",type:"number",label:t("common.priority"),extraProps:{precision:0}}]),F=async a=>{await C(z,{id:a.id||0},t("common.delete")),p.value.getTableList()},N=(a,e)=>{h.value[2].optionsData=f.value,a==="update"&&e&&(delete e.createdAt,delete e.updatedAt);let o={title:t(`common.${a}`)+k,rowData:{...e||{priority:0,enable:!0,typeId:1}},formType:a,api:a=="add"?S:O,getTableList:p.value.getTableList};T.value.acceptParams(o)},$=async a=>{try{const e=await C(U,{ids:a},t("common.delete"));p.value.getTableList(),p.value.clearSelection(),e.status===0&&V(e.data)}catch{}},E=(a,e)=>{switch(a){case"delete":$(e.map(o=>o.id||0));break}};return(async()=>{const a=await G({pageSize:-1});f.value=a.data.map(e=>({label:e.classifyName,value:e.id})),h.value[2].optionsData=f.value})(),(a,e)=>{const o=n("el-button"),i=n("arrow-down"),l=n("el-icon"),m=n("el-dropdown-menu"),y=n("el-dropdown"),g=n("el-upload"),w=n("el-space"),P=n("ProTable"),q=n("FormDialog");return j(),H("div",J,[r(P,{ref_key:"proTable",ref:p,colSettingType:"base_sku",title:c(k),columns:B.value,requestApi:c(W)},{tableHeader:s(d=>[r(w,null,{default:s(()=>[r(o,{type:"primary",onClick:e[0]||(e[0]=v=>N("add"))},{default:s(()=>[_(b(c(t)("common.add")),1)]),_:1}),r(y,{disabled:!d.isSelected,size:"default"},{dropdown:s(()=>[r(m,null,{default:s(()=>[I("div",{class:"dropdown-item",onClick:v=>E("delete",d.selectedList)},b(c(t)("common.delete")),9,Q)]),_:2},1024)]),default:s(()=>[r(o,{type:"primary",disabled:!d.isSelected},{default:s(()=>[_(b(c(t)("common.batch")),1),r(l,{class:"el-icon--right"},{default:s(()=>[r(i)]),_:1})]),_:2},1032,["disabled"])]),_:2},1032,["disabled"]),r(g,{action:"#","before-upload":A},{default:s(()=>[r(o,{type:"primary"},{default:s(()=>[_("Upload")]),_:1})]),_:1})]),_:2},1024)]),operation:s(d=>[r(o,{type:"primary",size:"small",onClick:v=>N("update",{...d.row})},{default:s(()=>[_(b(c(t)("common.edit")),1)]),_:2},1032,["onClick"]),r(o,{type:"danger",size:"small",onClick:v=>F(d.row)},{default:s(()=>[_(b(c(t)("common.delete")),1)]),_:2},1032,["onClick"])]),_:1},8,["title","columns","requestApi"]),r(q,{width:"70vw",columns:h.value,ref_key:"formDialogRef",ref:T},null,8,["columns"])])}}});export{re as default};
