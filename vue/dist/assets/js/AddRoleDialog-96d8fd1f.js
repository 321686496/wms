import{o as $,C as m,q as c,a7 as O,t as D,u as E,w as u,K as j,v as n,a2 as b,L as h,x as f,M as z,P as G,O as J,_ as x,$ as Q,E as X,ae as A}from"./vendor-7d8626b5.js";import{u as s,o as Y,_ as Z}from"./index-16b2bfc2.js";import{b as ee}from"./select-d4c05a16.js";import{r as le}from"./serviceDict-09318a0d.js";const ae={class:"dialog-footer"},oe=$({name:"AddRoleDialog"}),te=$({...oe,props:{width:{default:"520px"},labelWidth:{default:"100px"}},setup(I,{expose:R}){const k=I,v=m(!1),a=m({title:"",formType:"add",rowData:{}}),w=m(),L=m({name:[{required:!0,message:s(["common.pleaseInput","system.role","common.name"]),trigger:"blur"}],roleType:[{required:!0,message:s(["common.pleaseSelect","system.role","common.type"]),trigger:"blur"}]}),_=m(!1),N=()=>{w.value.validate(async l=>{if(l){_.value=!0;let e=M();const t=a.value.handleData?a.value.handleData(a.value.rowData):{...a.value.rowData,menuIds:e};a.value.api(t).then(r=>{r.status===0&&(X.success({message:`${a.value.title}${s("common.success")}!`}),_.value=!1,a.value.getTableList&&a.value.getTableList(),v.value=!1)}).finally(()=>{_.value=!1})}})},i=m([]),p=m(),y=m({expand:!1,nodeAll:!1}),T=l=>(l.forEach(e=>{e.label=s(`menu.${e.label}`),e.children&&e.children.length&&(e.children=T(e.children))}),l),g=m(!1),U=()=>{g.value=!0,ee().then(l=>{var t,r;i.value=T(l.data);const e=[];i.value[0]&&(i.value[0].disabled=!0,e.push(i.value[0].value),(r=(t=i.value[0])==null?void 0:t.children)==null||r.forEach(d=>{["\u5355\u636E\u4E22\u5931","\u8054\u67E5\u7ED3\u679C"].includes(d.label)&&(d.disabled=!0,e.push(d.value))})),a.value.formType==="update"&&a.value.rowData.menuIds&&a.value.rowData.menuIds.length&&a.value.rowData.menuIds.forEach(d=>{A(()=>{p.value.setChecked(d,!0,!1)})}),e==null||e.forEach(d=>{A(()=>{p.value.setChecked(d,!0,!1)})})}).finally(()=>{g.value=!1})},F=l=>{let e=i.value;for(let t=0;t<e.length;t++)p.value.store.nodesMap[e[t].value].expanded=l},K=l=>{const e=Y(i.value);l?p.value.setCheckedNodes(e):p.value.setCheckedNodes(e.filter(t=>["\u5355\u636E\u4E22\u5931","\u8054\u67E5\u7ED3\u679C"].includes(t.label)))},M=()=>{let l=p.value.getCheckedKeys(),e=p.value.getHalfCheckedKeys();return[...l,...e]};let P={roleType:"SUPER"};return R({acceptParams:l=>{U(),a.value={...l,rowData:l.formType==="add"?{...P}:l.rowData},v.value=!0}}),(l,e)=>{const t=c("el-input"),r=c("el-form-item"),d=c("el-radio-button"),S=c("el-radio-group"),V=c("el-checkbox"),q=c("el-tree"),B=c("el-form"),C=c("el-button"),W=c("el-dialog"),H=O("loading");return D(),E(W,{modelValue:v.value,"onUpdate:modelValue":e[6]||(e[6]=o=>v.value=o),title:a.value.title,width:k.width,"destroy-on-close":""},{footer:u(()=>[j("span",ae,[n(C,{onClick:e[5]||(e[5]=o=>v.value=!1),disabled:_.value},{default:u(()=>[b(h(l.$t("common.cancel")),1)]),_:1},8,["disabled"]),n(C,{type:"primary",loading:_.value,onClick:N},{default:u(()=>[b(h(l.$t("common.submit")),1)]),_:1},8,["loading"])])]),default:u(()=>[n(B,{ref_key:"ruleFormRef",ref:w,"label-width":k.labelWidth,"label-suffix":" :",model:a.value.rowData,rules:L.value},{default:u(()=>[n(r,{label:f(s)(["system.role","common.name"]),prop:"name"},{default:u(()=>[n(t,{modelValue:a.value.rowData.name,"onUpdate:modelValue":e[0]||(e[0]=o=>a.value.rowData.name=o),placeholder:f(s)(["common.pleaseInput","system.role","common.name"]),clearable:""},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),n(r,{label:f(s)(["system.role","common.type"]),prop:"roleType"},{default:u(()=>[n(S,{modelValue:a.value.rowData.roleType,"onUpdate:modelValue":e[1]||(e[1]=o=>a.value.rowData.roleType=o)},{default:u(()=>[(D(!0),z(G,null,J(f(le),o=>(D(),E(d,{key:o.value,label:o.value},{default:u(()=>[b(h(o.label),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),x(n(r,{label:f(s)(["system.menu","system.permission"]),prop:"menuIds"},{default:u(()=>[n(V,{modelValue:y.value.expand,"onUpdate:modelValue":e[2]||(e[2]=o=>y.value.expand=o),onChange:F},{default:u(()=>[b(h(l.$t("common.expand")+"/"+l.$t("common.fold")),1)]),_:1},8,["modelValue"]),n(V,{modelValue:y.value.nodeAll,"onUpdate:modelValue":e[3]||(e[3]=o=>y.value.nodeAll=o),onChange:K},{default:u(()=>[b(h(l.$t("common.selectAll")+"/"+l.$t("common.deselectAll")),1)]),_:1},8,["modelValue"]),x(n(q,{ref_key:"menuTreeRef",ref:p,class:"tree-border",style:{width:"100%"},data:i.value,"show-checkbox":"","node-key":"value"},null,8,["data"]),[[H,g.value]])]),_:1},8,["label"]),[[Q,a.value.rowData.roleType==="ADMIN"]]),n(r,{label:f(s)("common.remark"),prop:"remark"},{default:u(()=>[n(t,{modelValue:a.value.rowData.remark,"onUpdate:modelValue":e[4]||(e[4]=o=>a.value.rowData.remark=o),placeholder:f(s)(["common.pleaseInput","common.remark"]),clearable:""},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1},8,["label-width","model","rules"])]),_:1},8,["modelValue","title","width"])}}});const me=Z(te,[["__scopeId","data-v-ec3d0b3c"]]);export{me as default};
